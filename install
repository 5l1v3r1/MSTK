#!/bin/sh

if [ "$1" = "" ]
then
  echo "USAGE: install version_number"
  exit
fi

VER=$1


# Get the machine type and kernel name. Piping the output of uname
# through (tr '[A-Z]' '[a-z]') converts the string to lower case

ARCH=`uname -m | tr '[A-Z]' '[a-z]'`
OS=`uname -s | tr '[A-Z]' '[a-z]'`
echo $ARCH
echo $OS
ARCHOS="$ARCH"_"$OS"
echo $ARCHOS


INSTALL_TOPDIR=$HOME

#----------- DO NOT EDIT BELOW THIS LINE --------------------------------------

LOCAL_LIBDIR=./lib/$ARCHOS
LOCAL_INCDIR=./include/
INSTALL_LIBDIR=$INSTALL_TOPDIR/lib/$ARCHOS
INSTALL_INCDIR=$INSTALL_TOPDIR/include/mstk-$VER
INSTALL_INCDIR_DEFAULT=$INSTALL_TOPDIR/include/mstk

# MAKE THIS THE DEFAULT VERSION?

default=n
echo "Do you want to make the installed version the default?"
read ans
if [ "$ans" = "y" ] || [ "$ans" = "yes" ] || [ "$ans" = "Y" ] || [ "$ans" = "YES" ]
then
  default=y
fi


# INSTALL THE INCLUDE FILES

if [ ! -d $INSTALL_INCDIR ]
then
  mkdir -p $INSTALL_INCDIR
fi

if [ "$default" = "y" ]
then
  ln -sfn $INSTALL_INCDIR $INSTALL_INCDIR_DEFAULT 
fi

ans=y
if [ -f $INSTALL_INCDIR/MSTK.h ]
then
  echo $INSTALL_INCDIR/MSTK.h " exists!! Overwrite?"
  read ans
fi

if [ "$ans" = "y" ] || [ "$ans" = "yes" ] || [ "$ans" = "Y" ] || [ "$ans" = "YES" ]
then
  cp $LOCAL_INCDIR/MSTK.h $LOCAL_INCDIR/MSTK_defines.h \
     $LOCAL_INCDIR/MSTK_types.h $LOCAL_INCDIR/MSTK_externs.h \
     $LOCAL_INCDIR/MSTK_util.h $LOCAL_INCDIR/MSTK_malloc.h \
     $LOCAL_INCDIR/List.h \
     $INSTALL_INCDIR
fi


# INSTALL THE LIBRARIES

ans=y
if [ ! -d $INSTALL_LIBDIR ]
then
  mkdir -p $INSTALL_LIBDIR
fi

if [ -f $INSTALL_LIBDIR/libmstk-$VER.a ]
then
  echo "$INSTALL_LIBDIR/libmstk-$VER.a exists!! Overwrite?"
  read ans
fi

if [ "$ans" = "y" ] || [ "$ans" = "yes" ] || [ "$ans" = "Y" ] || [ "$ans" = "YES" ]
then
  cp $LOCAL_LIBDIR/libmstk.a $INSTALL_LIBDIR/libmstk-$VER.a
fi

if [ "$default" = "y" ]
then
  ln -sf $INSTALL_LIBDIR/libmstk-$VER.a $INSTALL_LIBDIR/libmstk.a 
fi

ans=y
if [ -f $INSTALL_LIBDIR/libmstk-d-$VER.a ]
then
  echo "$INSTALL_LIBDIR/libmstk-d-$VER.a exists!! Overwrite?"
  read ans
fi

if [ "$ans" = "y" ] || [ "$ans" = "yes" ] || [ "$ans" = "Y" ] || [ "$ans" = "YES" ]
then
  cp $LOCAL_LIBDIR/libmstk-d.a $INSTALL_LIBDIR/libmstk-d-$VER.a
fi

if [ "$default" = "y" ]
then
  ln -sf $INSTALL_LIBDIR/libmstk-d-$VER.a $INSTALL_LIBDIR/libmstk-d.a 
fi


